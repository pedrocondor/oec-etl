<?xml version="1.0" encoding="UTF-8"?>
<Schema name="atlas">

    <Dimension name="Countries">
        <Hierarchy hasAll="true" primaryKey="iso3">
            <Table name="countries" schema="public" />
            <Level name="Continent" column="continent" nameColumn="continent"
                   uniqueMembers="true" />
            <Level name="Country" column="iso3" nameColumn="name" uniqueMembers="true">
                <Property column="ar_name" name="Country AR" />
                <Property column="de_name" name="Country DE" />
                <Property column="el_name" name="Country EL" />
                <Property column="en_name" name="Country EN" />
                <Property column="es_name" name="Country ES" />
                <Property column="fr_name" name="Country FR" />
                <Property column="he_name" name="Country HE" />
                <Property column="hi_name" name="Country HI" />
                <Property column="it_name" name="Country IT" />
                <Property column="ja_name" name="Country JA" />
                <Property column="ko_name" name="Country KO" />
                <Property column="mn_name" name="Country MN" />
                <Property column="nl_name" name="Country NL" />
                <Property column="pt_name" name="Country PT" />
                <Property column="ru_name" name="Country RU" />
                <Property column="tr_name" name="Country TR" />
                <Property column="vi_name" name="Country VI" />
                <Property column="zh_name" name="Country ZH" />
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="HS92">
        <Hierarchy hasAll="true" primaryKey="hs6" uniqueKeyLevelName="hs6_name">
            <Table name="hs92" schema="public" />

            <Level name="Chapter" column="chapter" nameColumn="chapter_name"
                   uniqueMembers="false">
                <Property column="chapter_ar_name" name="Chapter AR" />
                <Property column="chapter_de_name" name="Chapter DE" />
                <Property column="chapter_el_name" name="Chapter EL" />
                <Property column="chapter_en_name" name="Chapter EN" />
                <Property column="chapter_es_name" name="Chapter ES" />
                <Property column="chapter_fr_name" name="Chapter FR" />
                <Property column="chapter_he_name" name="Chapter HE" />
                <Property column="chapter_hi_name" name="Chapter HI" />
                <Property column="chapter_it_name" name="Chapter IT" />
                <Property column="chapter_ja_name" name="Chapter JA" />
                <Property column="chapter_ko_name" name="Chapter KO" />
                <Property column="chapter_mn_name" name="Chapter MN" />
                <Property column="chapter_nl_name" name="Chapter NL" />
                <Property column="chapter_pt_name" name="Chapter PT" />
                <Property column="chapter_ru_name" name="Chapter RU" />
                <Property column="chapter_tr_name" name="Chapter TR" />
                <Property column="chapter_vi_name" name="Chapter VI" />
                <Property column="chapter_zh_name" name="Chapter ZH" />
            </Level>
            <Level name="HS2" column="hs2" nameColumn="hs2_name" uniqueMembers="false">
                <Property column="hs2_ar_name" name="HS2 AR" />
                <Property column="hs2_de_name" name="HS2 DE" />
                <Property column="hs2_el_name" name="HS2 EL" />
                <Property column="hs2_en_name" name="HS2 EN" />
                <Property column="hs2_es_name" name="HS2 ES" />
                <Property column="hs2_fr_name" name="HS2 FR" />
                <Property column="hs2_he_name" name="HS2 HE" />
                <Property column="hs2_hi_name" name="HS2 HI" />
                <Property column="hs2_it_name" name="HS2 IT" />
                <Property column="hs2_ja_name" name="HS2 JA" />
                <Property column="hs2_ko_name" name="HS2 KO" />
                <Property column="hs2_mn_name" name="HS2 MN" />
                <Property column="hs2_nl_name" name="HS2 NL" />
                <Property column="hs2_pt_name" name="HS2 PT" />
                <Property column="hs2_ru_name" name="HS2 RU" />
                <Property column="hs2_tr_name" name="HS2 TR" />
                <Property column="hs2_vi_name" name="HS2 VI" />
                <Property column="hs2_zh_name" name="HS2 ZH" />
            </Level>
            <Level name="HS4" column="hs4" nameColumn="hs4_name" uniqueMembers="false">
                <Property column="hs4_ar_name" name="HS4 AR" />
                <Property column="hs4_de_name" name="HS4 DE" />
                <Property column="hs4_el_name" name="HS4 EL" />
                <Property column="hs4_en_name" name="HS4 EN" />
                <Property column="hs4_es_name" name="HS4 ES" />
                <Property column="hs4_fr_name" name="HS4 FR" />
                <Property column="hs4_he_name" name="HS4 HE" />
                <Property column="hs4_hi_name" name="HS4 HI" />
                <Property column="hs4_it_name" name="HS4 IT" />
                <Property column="hs4_ja_name" name="HS4 JA" />
                <Property column="hs4_ko_name" name="HS4 KO" />
                <Property column="hs4_mn_name" name="HS4 MN" />
                <Property column="hs4_nl_name" name="HS4 NL" />
                <Property column="hs4_pt_name" name="HS4 PT" />
                <Property column="hs4_ru_name" name="HS4 RU" />
                <Property column="hs4_tr_name" name="HS4 TR" />
                <Property column="hs4_vi_name" name="HS4 VI" />
                <Property column="hs4_zh_name" name="HS4 ZH" />
            </Level>
            <Level name="HS6" column="hs6" nameColumn="hs6_name" uniqueMembers="true">
                <Property column="hs6_ar_name" name="HS6 AR" />
                <Property column="hs6_de_name" name="HS6 DE" />
                <Property column="hs6_el_name" name="HS6 EL" />
                <Property column="hs6_en_name" name="HS6 EN" />
                <Property column="hs6_es_name" name="HS6 ES" />
                <Property column="hs6_fr_name" name="HS6 FR" />
                <Property column="hs6_he_name" name="HS6 HE" />
                <Property column="hs6_hi_name" name="HS6 HI" />
                <Property column="hs6_it_name" name="HS6 IT" />
                <Property column="hs6_ja_name" name="HS6 JA" />
                <Property column="hs6_ko_name" name="HS6 KO" />
                <Property column="hs6_mn_name" name="HS6 MN" />
                <Property column="hs6_nl_name" name="HS6 NL" />
                <Property column="hs6_pt_name" name="HS6 PT" />
                <Property column="hs6_ru_name" name="HS6 RU" />
                <Property column="hs6_tr_name" name="HS6 TR" />
                <Property column="hs6_vi_name" name="HS6 VI" />
                <Property column="hs6_zh_name" name="HS6 ZH" />
            </Level>
        </Hierarchy>
    </Dimension>

    <Dimension name="HS96">
    </Dimension>

    <Dimension name="HS02">
    </Dimension>

    <Dimension name="HS07">
    </Dimension>


    <Cube name="attr_yo">
        <Table name="attr_yo" schema="public" />

        <Dimension name="year" type="TimeDimension">
           <Hierarchy hasAll="true" primaryKey="year">
               <Level column="year" name="year" levelType="TimeYears" type="Numeric"
                      uniqueMembers="true" />
           </Hierarchy>
        </Dimension>

        <!-- Foreign key -->
        <DimensionUsage name="Country" caption="Country" source="Countries"
                        foreignKey="country" />

        <!-- These are not all the fields, so I am assuming these are only the
        ones we want to aggregate by. -->
        <Measure name="eci" column="eci" aggregator="sum" />
        <Measure name="population" column="population" aggregator="sum" />
        <Measure name="gdp" column="gdp" aggregator="sum" />
        <Measure name="gdp_pc_constant" column="gdp_pc_constant" aggregator="sum" />
        <Measure name="gdp_pc_current" column="gdp_pc_current" aggregator="sum" />
        <Measure name="gdp_pc_constant_ppp" column="gdp_pc_constant_ppp" aggregator="sum" />
        <Measure name="gdp_pc_current_ppp" column="gdp_pc_current_ppp" aggregator="sum" />
        <Measure name="gini" column="gini" aggregator="sum" />
        <Measure name="xgini" column="xgini" aggregator="sum" />
    </Cube>


    <Cube name="hs92_yearly_data">
        <Table name="hs92_yearly_data" schema="public" />

        <Dimension name="year" type="TimeDimension">
           <Hierarchy hasAll="true" primaryKey="year">
               <Level column="year" name="year" levelType="TimeYears" type="Numeric"
                      uniqueMembers="true" />
           </Hierarchy>
        </Dimension>

        <!-- Foreign keys (imagine this is a fact table) -->
        <DimensionUsage name="Origin Country" caption="Origin Country" source="Countries"
                        foreignKey="origin_id" />
        <DimensionUsage name="Destination Country" caption="Destination Country"
                        source="Countries" foreignKey="dest_id" />
        <DimensionUsage name="Product" source="HS92" foreignKey="hs92_id" />

        <Measure name="Exports" column="export_val" aggregator="sum" />
        <Measure name="Imports" column="import_val" aggregator="sum" />


        <!-- Export RCA -->

        <CalculatedMember dimension="Measures" name="export_cpy_rca_b_pop" visible="false">
            <Formula>
                <![CDATA[
                    (Measures.[Exports], [year].[year].CurrentMember,
            [Origin Country].[Countries].CurrentMember,
            [Destination Country].[Countries].[All Countriess],
            [Product].[HS92].[All HS92s])
                ]]>
            </Formula>
        </CalculatedMember>

        <CalculatedMember dimension="Measures" name="export_cpy_rca_c_pop" visible="false">
            <Formula>
                <![CDATA[
                    (Measures.[Exports], [year].[year].CurrentMember,
            [Origin Country].[Countries].[All Countriess],
            [Destination Country].[Countries].[All Countriess],
            [Product].[HS92].CurrentMember)
                ]]>
            </Formula>
        </CalculatedMember>

        <CalculatedMember dimension="Measures" name="export_cpy_rca_d_pop" visible="false">
             <Formula>
                <![CDATA[
                    (Measures.[Exports], [year].[year].CurrentMember,
            [Origin Country].[Countries].[All Countriess],
            [Destination Country].[Countries].[All Countriess],
            [Product].[HS92].[All HS92s])
                ]]>
            </Formula>
        </CalculatedMember>

        <CalculatedMember dimension="Measures" name="Export RCA" visible="true">
            <Formula>
                <![CDATA[
                IIF([Measures].[cpy_rca_c_pop] > 0 and [Measures].[cpy_rca_d_pop] > 0,
                 ([Measures].[Exports] / [Measures].[export_cpy_rca_b_pop]) /
                 ([Measures].[export_cpy_rca_c_pop] / [Measures].[export_cpy_rca_d_pop])
                 , NULL)
                ]]>
            </Formula>
        </CalculatedMember>

        <!-- Import RCA -->

        <CalculatedMember dimension="Measures" name="import_cpy_rca_b_pop" visible="false">
            <Formula>
                <![CDATA[
                    (Measures.[Imports], [year].[year].CurrentMember,
            [Origin Country].[Countries].CurrentMember,
            [Destination Country].[Countries].[All Countriess],
            [Product].[HS92].[All HS92s])
                ]]>
            </Formula>
        </CalculatedMember>

        <CalculatedMember dimension="Measures" name="import_cpy_rca_c_pop" visible="false">
            <Formula>
                <![CDATA[
                    (Measures.[Imports], [year].[year].CurrentMember,
            [Origin Country].[Countries].[All Countriess],
            [Destination Country].[Countries].[All Countriess],
            [Product].[HS92].CurrentMember)
                ]]>
            </Formula>
        </CalculatedMember>

        <CalculatedMember dimension="Measures" name="import_cpy_rca_d_pop" visible="false">
             <Formula>
                <![CDATA[
                    (Measures.[Imports], [year].[year].CurrentMember,
            [Origin Country].[Countries].[All Countriess],
            [Destination Country].[Countries].[All Countriess],
            [Product].[HS92].[All HS92s])
                ]]>
            </Formula>
        </CalculatedMember>

        <CalculatedMember dimension="Measures" name="Export RCA" visible="true">
            <Formula>
                <![CDATA[
                IIF([Measures].[cpy_rca_c_pop] > 0 and [Measures].[cpy_rca_d_pop] > 0,
                 ([Measures].[Imports] / [Measures].[import_cpy_rca_b_pop]) /
                 ([Measures].[import_cpy_rca_c_pop] / [Measures].[import_cpy_rca_d_pop])
                 , NULL)
                ]]>
            </Formula>
        </CalculatedMember>
    </Cube>

    <Cube name="hs96_yearly_data">
    </Cube>

    <Cube name="hs02_yearly_data">
    </Cube>

    <Cube name="hs07_yearly_data">
    </Cube>
</Schema>
